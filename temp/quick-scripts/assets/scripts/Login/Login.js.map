{"version":3,"sources":["Login.js"],"names":["GLB","require","engine","msg","cc","Class","extends","Component","properties","gameIdInput","Node","confirm","clear","quick","labelInfo","default","type","Label","onLoad","self","initEvent","prototype","init","channel","platform","gameID","on","EventType","TOUCH_END","isInit","getComponent","EditBox","string","playerID","startLogin","console","log","LocalStore_Clear","registerUser","systemEvent","MATCHVS_INIT","onEvent","MATCHVS_RE_CONNECT","MATCHVS_ERROE_MSG","MATCHVS_REGISTER_USER","MATCHVS_LOGIN","event","eventData","data","labelLog","sys","localStorage","setItem","JSON","stringify","userInfo","login","id","token","MsLoginRsp","roomID","reconnect","director","loadScene","roomUserInfoList","owner","userID","isRoomOwner","state","roomProperty","leaveRoom","errorCode","errorMsg","key","userData","parse","getItem","name","avatar","error","warn","message","removeEvent","off","info","onDestroy"],"mappings":"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","file":"Login.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\Login","sourcesContent":["/**\n * 登录\n */\n\nlet GLB = require(\"../interface/Glb\");//GLB是用来存储用户参数的脚本\nlet engine = require(\"../MatchvsLib/MatchvsDemoEngine\");\nlet msg = require(\"../MatchvsLib/MatvhvsMessage\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        gameIdInput: cc.Node,\n        confirm: cc.Node,\n        clear: cc.Node,\n        quick: cc.Node,\n        labelInfo: {\n            default: null,\n            type: cc.Label\n        }\n    },\n\n\n    /**\n     * load 显示页面\n     */\n    onLoad: function () {\n        let self = this;\n        this.initEvent();\n        engine.prototype.init(GLB.channel,GLB.platform,GLB.gameID);\n        this.confirm.on(cc.Node.EventType.TOUCH_END, function () {\n            if(!GLB.isInit)\n                return;\n            // 获取用户输入的参数\n            if (self.gameIdInput.getComponent(cc.EditBox).string !== \"\"){\n                GLB.playerID = self.gameIdInput.getComponent(cc.EditBox).string;\n                self.startLogin(GLB.playerID,self);\n            }else{\n                console.log(\"输入为空\");\n            }\n        });\n        this.clear.on(cc.Node.EventType.TOUCH_END, function () {\n            if (LocalStore_Clear) {\n                LocalStore_Clear()\n            }\n            console.log(\"clear user info cache\");\n        });\n        this.quick.on(cc.Node.EventType.TOUCH_END,function () {\n            if(!GLB.isInit)\n                return;\n            engine.prototype.registerUser();\n            \n            \n        });\n    },\n\n    /**\n     * 注册对应的事件监听和把自己的原型传递进入，用于发送事件使用\n     */\n    initEvent:function () {\n        cc.systemEvent.on(msg.MATCHVS_INIT,this.onEvent,this);\n        cc.systemEvent.on(msg.MATCHVS_RE_CONNECT,this.onEvent,this);\n        cc.systemEvent.on(msg.MATCHVS_ERROE_MSG,this.onEvent,this);\n        cc.systemEvent.on(msg.MATCHVS_REGISTER_USER,this.onEvent,this);\n        cc.systemEvent.on(msg.MATCHVS_LOGIN,this.onEvent,this);\n    },\n\n\n    /**\n     * 事件接收方法\n     * @param event\n     */\n    onEvent:function (event) {\n        let eventData = event.data;\n        switch (event.type){\n            case msg.MATCHVS_INIT:\n                this.labelLog('初始化成功');\n                GLB.isInit = true;\n                break;\n            case msg.MATCHVS_REGISTER_USER:\n                cc.sys.localStorage.setItem(GLB.playerID,JSON.stringify(eventData.userInfo));\n                this.login(eventData.userInfo.id,eventData.userInfo.token);\n                break;\n            case msg.MATCHVS_LOGIN:\n                if (eventData.MsLoginRsp.roomID != null && eventData.MsLoginRsp.roomID !== '0') {\n                    console.log(\"开始重连\"+ eventData.MsLoginRsp.roomID);\n                    engine.prototype.reconnect();\n                } else {\n                    cc.director.loadScene(\"Lobby\");\n                }\n                break;\n            case msg.MATCHVS_RE_CONNECT:\n                GLB.roomID = eventData.roomUserInfoList.roomID;\n                if (eventData.roomUserInfoList.owner === GLB.userID) {\n                    GLB.isRoomOwner = true;\n                } else {\n                    GLB.isRoomOwner = false;\n                }\n                if (eventData.roomUserInfoList.state === 1) {\n                    if (eventData.roomUserInfoList.roomProperty === \"\") {\n                        engine.prototype.leaveRoom();\n                        cc.director.loadScene(\"Lobby\");\n                    } else  {\n                        cc.director.loadScene('CreateRoom');\n                    }\n                } else {\n                    cc.director.loadScene(\"zyankenGame\");\n                }\n                break;\n            case msg.MATCHVS_ERROE_MSG:\n                this.labelLog(\"[Err]errCode:\"+eventData.errorCode+\" errMsg:\"+eventData.errorMsg);\n                break;\n        }\n    },\n\n    startLogin:function(key,self){\n        try {\n            var userData = JSON.parse(cc.sys.localStorage.getItem(key));\n            console.log(userData);\n            if (userData.name !== \"\") {\n                GLB.name = userData.name;\n            } else {\n                GLB.name = userData.userID;\n            }\n            GLB.avatar = userData.avatar;\n            GLB.userID = userData.userID;\n            self.login(userData.id,userData.token);\n        } catch (error) {\n            console.warn(\"startLogin for error:\"+error.message);\n            engine.prototype.registerUser();\n        }\n    },\n\n    /**\n     * 登录\n     * @param id\n     * @param token\n     */\n    login: function (id, token) {\n        GLB.userID = id;\n        this.labelLog('开始登录...用户ID:' + id + \" gameID \" + GLB.gameID);\n        engine.prototype.login(id,token);\n    },\n\n    /**\n     * 移除监听\n     */\n    removeEvent:function () {\n        cc.systemEvent.off(msg.MATCHVS_INIT,this.onEvent);\n        cc.systemEvent.off(msg.MATCHVS_RE_CONNECT,this.onEvent);\n        cc.systemEvent.off(msg.MATCHVS_ERROE_MSG,this.onEvent);\n        cc.systemEvent.off(msg.MATCHVS_REGISTER_USER,this.onEvent);\n        cc.systemEvent.off(msg.MATCHVS_LOGIN,this.onEvent);\n    },\n\n    /**\n     * 页面log打印\n     * @param info\n     */\n    labelLog: function (info) {\n        this.labelInfo.string += '\\n[LOG]: ' + info;\n    },\n\n    /**\n     * 生命周期，页面销毁\n     */\n    onDestroy () {\n        this.removeEvent();\n        console.log(\"Login页面销毁\");\n    },\n\n  \n});\n"]}