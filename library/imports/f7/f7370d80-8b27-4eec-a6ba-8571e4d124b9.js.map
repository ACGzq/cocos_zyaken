{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\interface/assets\\scripts\\interface\\RoomList.js"],"names":["engine","require","mvs","GLB","msg","refreshNum","time","cc","Class","extends","Component","properties","back","Node","itemTemplate","default","type","scrollView","ScrollView","spacing","totalCount","labelInfo","Label","refreshNumText","onLoad","content","items","initEvent","getRooomList","on","EventType","TOUCH_END","director","loadScene","setInterval","RoomFilterEx","MsRoomFilterEx","maxPlayer","MAX_PLAYER_COUNT","mode","canWatch","pageNo","pageSize","prototype","getRoomListEx","systemEvent","MATCHVS_ERROE_MSG","onEvent","MATCHVS_ROOM_LIST_EX","MATCHVS_JOIN_ROOM_RSP","MATCHVS_NETWORK_STATE_NOTIFY","event","eventData","data","getRoomListExResponse","rsp","errorCode","labelLog","console","warn","errorMsg","roomID","userInfoList","netNotify","userID","state","log","roomListExInfo","string","total","height","removeAllChildren","i","item","instantiate","addChild","setPosition","getComponent","updateItem","roomAttrs","info","onDestroy","clearInterval","removeEvent","off"],"mappings":"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","file":"RoomList.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\interface","sourcesContent":["let engine = require(\"../MatchvsLib/MatchvsDemoEngine\");\nlet mvs = require(\"../MatchvsLib/Matchvs\");\nlet GLB = require(\"../interface/Glb\");\nlet msg = require(\"../MatchvsLib/MatvhvsMessage\");\nlet refreshNum = 0;\nlet time;\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        back: cc.Node,\n\n        itemTemplate: { // item template to instantiate other items\n            default: null,\n            type: cc.Node\n        },\n\n        scrollView: {\n            default: null,\n            type: cc.ScrollView\n        },\n        spacing: 0,\n        totalCount: 0,\n        labelInfo: {\n            default: null,\n            type: cc.Label\n        },\n        refreshNumText: {\n            default: null,\n            type: cc.Label\n        },\n\n    },\n\n\n    onLoad:function () {\n        this.content = this.scrollView.content;\n        this.items = [];\n        this.initEvent();\n        this.getRooomList();\n        this.back.on(cc.Node.EventType.TOUCH_END, function(){\n            cc.director.loadScene(\"Lobby\");\n        });\n\n        time = setInterval(this.getRooomList,10000);\n    },\n\n\n    getRooomList:function () {\n        let RoomFilterEx = new mvs.MsRoomFilterEx();\n        RoomFilterEx.maxPlayer = GLB.MAX_PLAYER_COUNT;\n        RoomFilterEx.mode = 0;\n        RoomFilterEx.canWatch = 0;\n        RoomFilterEx.pageNo = 0;\n        RoomFilterEx.pageSize = 10;\n        engine.prototype.getRoomListEx(RoomFilterEx);\n    },\n\n\n    /**\n     * 注册对应的事件监听和把自己的原型传递进入，用于发送事件使用\n     */\n    initEvent () {\n        cc.systemEvent.on(msg.MATCHVS_ERROE_MSG,this.onEvent,this);\n        cc.systemEvent.on(msg.MATCHVS_ROOM_LIST_EX,this.onEvent,this);\n        cc.systemEvent.on(msg.MATCHVS_JOIN_ROOM_RSP,this.onEvent,this);\n        cc.systemEvent.on(msg.MATCHVS_NETWORK_STATE_NOTIFY,this.onEvent,this);\n    },\n\n    /**\n     * 接收事件\n     * @param event\n     */\n    onEvent :function (event) {\n        let eventData = event.data;\n        switch (event.type) {\n            case msg.MATCHVS_ROOM_LIST_EX:\n                this.getRoomListExResponse(eventData.rsp);\n                break;\n            case msg.MATCHVS_ERROE_MSG:\n                if (eventData.errorCode === 405) {\n                    this.labelLog(\"房间人数已满\");\n                    console.warn(\"房间人数已满\");\n                    return;\n                }\n                if (eventData.errorCode === 406) {\n                    this.labelLog(\"房间已joinOver\");\n                    console.warn(\"房间已joinOver\");\n                    return;\n                }\n                this.labelLog(\"[Err]errCode:\"+eventData.errorCode+\" errMsg:\"+eventData.errorMsg);\n                cc.director.loadScene('Login');\n                break;\n            case msg.MATCHVS_JOIN_ROOM_RSP:\n                GLB.roomID = eventData.userInfoList.roomID;\n                this.labelLog(\"加入指定房间成功, roomID:\" +  GLB.roomID);\n                cc.director.loadScene('CreateRoom');\n                break;\n            case msg.MATCHVS_NETWORK_STATE_NOTIFY:\n                if (eventData.netNotify.userID === GLB.userID && eventData.netNotify.state === 1) {\n                    console.log(\"netNotify.userID :\"+eventData.netNotify.userID +\"netNotify.state: \"+eventData.netNotify.state);\n                    cc.director.loadScene(\"Login\");\n                }\n                break;\n        }\n\n    },\n    \n\n\n    getRoomListExResponse: function(roomListExInfo) {\n        refreshNum ++;\n        this.refreshNumText.string = '获取列表次数'+ refreshNum;\n        this.totalCount  = roomListExInfo.total;\n        this.content.height = this.totalCount * (this.itemTemplate.height + this.spacing) + this.spacing; // get total content height\n        this.content.removeAllChildren(true);\n        for(let i = 0; i < roomListExInfo.total; i++) {\n            let item = cc.instantiate(this.itemTemplate);\n            this.content.addChild(item);\n            item.setPosition(0, -item.height * (0.5 + i) - this.spacing * (i + 1));\n            item.getComponent('Item').updateItem(roomListExInfo.roomAttrs[i]);\n        }\n    },\n\n    labelLog: function (info) {\n        this.labelInfo.string += '\\n' + info;\n    },\n\n    onDestroy:function() {\n        clearInterval(time);\n        refreshNum = 0;\n        this.removeEvent();\n        console.log(\"RoomList 页面销毁\");\n    },\n\n    /**\n     * 移除监听\n     */\n    removeEvent:function () {\n        cc.systemEvent.off(msg.MATCHVS_ERROE_MSG,this.onEvent);\n        cc.systemEvent.off(msg.MATCHVS_ROOM_LIST_EX,this.onEvent);\n        cc.systemEvent.off(msg.MATCHVS_JOIN_ROOM_RSP,this.onEvent);\n        cc.systemEvent.off(msg.MATCHVS_NETWORK_STATE_NOTIFY,this.onEvent);\n    },\n\n\n\n});\n"]}