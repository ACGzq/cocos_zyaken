{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\interface/assets\\scripts\\interface\\Lobby.js"],"names":["engine","require","GLB","mvs","msg","cc","Class","extends","Component","properties","randomMatch","Node","roomList","joinCertainRoom","createRoom","returnLogin","nickName","default","type","Label","avatar111","Sprite","onLoad","self","initEvent","string","name","console","log","avatar","wx","image","createImage","onload","texture","Texture2D","initWithElement","handleLoadedTexture","spriteFrame","SpriteFrame","e","src","loader","load","err","res","error","on","EventType","TOUCH_END","prototype","logout","director","loadScene","matchType","RANDOM_MATCH","syncFrame","create","MsCreateRoomInfo","maxPlayer","MAX_PLAYER_COUNT","mode","canWatch","visibility","roomProperty","systemEvent","MATCHVS_ERROE_MSG","onEvent","MATCHVS_CREATE_ROOM","MATCHVS_NETWORK_STATE_NOTIFY","event","eventData","data","roomID","rsp","netNotify","userID","state","removeEvent","off","onDestroy"],"mappings":"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","file":"Lobby.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\interface","sourcesContent":["/**\n * 大厅页面\n */\nlet engine = require(\"../MatchvsLib/MatchvsDemoEngine\");\nlet GLB = require(\"Glb\");\nlet mvs = require(\"../MatchvsLib/Matchvs\");\nlet msg = require(\"../MatchvsLib/MatvhvsMessage\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        randomMatch: cc.Node,\n        roomList: cc.Node,\n        joinCertainRoom: cc.Node,\n        createRoom: cc.Node,\n        returnLogin: cc.Node,\n       \n\n        nickName: {\n            default:null,\n            type:cc.Label\n        },\n        avatar111: {\n            default:null,\n            type:cc.Sprite\n        },\n    },\n\n    onLoad:function () {\n        let self = this;\n        this.initEvent();\n        this.nickName.string = \"用户ID：\"+ GLB.name;\n        console.log('avatar url', GLB.avatar);\n        if (typeof(wx) !== 'undefined') {\n            let image = wx.createImage();\n            image.onload = () => {\n                try {\n                    let texture = new cc.Texture2D();\n                    texture.initWithElement(image);\n                    texture.handleLoadedTexture();\n                    self.avatar111.spriteFrame = new cc.SpriteFrame(texture);\n                } catch (e) {\n                    console.log('wx onload image error');\n                }\n            };\n            image.src = GLB.avatar;\n        } else {\n            cc.loader.load(GLB.avatar, function (err, res) {\n                if (err) {\n                    console.error('load avatar image error', err);\n                    return;\n                }\n                self.avatar111.spriteFrame  = new cc.SpriteFrame(res);\n            }) ;\n        }\n        // 返回登录\n        this.returnLogin.on(cc.Node.EventType.TOUCH_END, function(){\n            engine.prototype.logout();\n            cc.director.loadScene('Login');\n        });\n\n        // 随机匹配\n        this.randomMatch.on(cc.Node.EventType.TOUCH_END, function(){\n            GLB.matchType = GLB.RANDOM_MATCH; // 修改匹配方式为随机匹配\n            GLB.syncFrame = false;\n           // self.labelLog('开始随机匹配');\n            cc.director.loadScene('Match');\n        });\n\n        // 自定义属性匹配\n        /*this.selfDefMatch.on(cc.Node.EventType.TOUCH_END, function(){\n            GLB.syncFrame = false;\n            cc.director.loadScene(\"SelfDefMatch\");\n        });*/\n\n        // 查看房间列表\n        this.roomList.on(cc.Node.EventType.TOUCH_END, function(){\n            GLB.syncFrame = false;\n            cc.director.loadScene(\"RoomList\");\n        });\n\n        // 加入指定房间\n        this.joinCertainRoom.on(cc.Node.EventType.TOUCH_END, function(){\n            GLB.syncFrame = false;\n            cc.director.loadScene(\"JoinCertainRoom\");\n        }); \n\n        // 创建房间\n        this.createRoom.on(cc.Node.EventType.TOUCH_END, function(){\n            GLB.syncFrame = false;\n            let create = new mvs.MsCreateRoomInfo();\n            create.name = 'roomName';\n            create.maxPlayer = GLB.MAX_PLAYER_COUNT;\n            create.mode = 0;\n            create.canWatch = 0;\n            create.visibility = 1;\n            create.roomProperty = '黑夜';\n            engine.prototype.createRoom(create,\"Matchvs\");\n        });\n\n     /*   this.buttonSyncFrame.on(cc.Node.EventType.TOUCH_END, function(){\n            GLB.syncFrame = true;\n            GLB.matchType = GLB.RANDOM_MATCH; // 修改匹配方式为随机匹配\n            cc.director.loadScene('Match');\n        });*/\n\n    },\n\n    /**\n     * 注册对应的事件监听和把自己的原型传递进入，用于发送事件使用\n     */\n    initEvent () {\n        cc.systemEvent.on(msg.MATCHVS_ERROE_MSG,this.onEvent,this);\n        cc.systemEvent.on(msg.MATCHVS_CREATE_ROOM,this.onEvent,this);\n        cc.systemEvent.on(msg.MATCHVS_NETWORK_STATE_NOTIFY,this.onEvent,this);\n    },\n\n    /**\n     * 接收事件\n     * @param event\n     */\n    onEvent (event) {\n        let eventData = event.data;\n        if (event.type === msg.MATCHVS_ERROE_MSG) {\n            cc.director.loadScene('Login');\n        } else if (event.type === msg.MATCHVS_CREATE_ROOM) {\n            GLB.roomID = eventData.rsp.roomID;\n            cc.director.loadScene(\"CreateRoom\");\n        } else if (event.type === msg.MATCHVS_NETWORK_STATE_NOTIFY){\n            if (eventData.netNotify.userID === GLB.userID && eventData.netNotify.state === 1) {\n                console.log(\"netNotify.userID :\"+eventData.netNotify.userID +\"netNotify.state: \"+eventData.netNotify.state);\n                cc.director.loadScene(\"Login\");\n            }\n        }\n    },\n\n    /**\n     * 移除监听\n     */\n    removeEvent() {\n        cc.systemEvent.off(msg.MATCHVS_ERROE_MSG,this.onEvent);\n        cc.systemEvent.off(msg.MATCHVS_CREATE_ROOM,this.onEvent);\n        cc.systemEvent.off(msg.MATCHVS_NETWORK_STATE_NOTIFY,this.onEvent);\n    },\n\n\n    /**\n     * 生命周期，页面销毁\n     */\n    onDestroy:function () {\n        this.removeEvent();\n        console.log(\"Lobby页面销毁\");\n    }\n\n\n});\n"]}